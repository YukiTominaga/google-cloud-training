---
description:
globs:
alwaysApply: true
---
# Hono TypeScript ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰é–‹ç™ºã‚¬ã‚¤ãƒ‰

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸå‰‡
- **å‹å®‰å…¨æ€§**: TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æœ€å¤§é™æ´»ç”¨ã—ã€å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã‚’æœ€å°åŒ–
- **SOLIDåŸå‰‡**: ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’é‡è¦–ã—ãŸè¨­è¨ˆ
- **Clean Architecture**: é–¢å¿ƒã®åˆ†é›¢ã¨ä¾å­˜é–¢ä¿‚ã®æ˜ç¢ºåŒ–
- **Honoãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨é–‹ç™ºä½“é¨“ã‚’ä¸¡ç«‹

## ğŸ“ æ¨å¥¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
src/
â”œâ”€â”€ routes/           # ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
â”œâ”€â”€ controllers/      # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
â”œâ”€â”€ services/         # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ repositories/     # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”œâ”€â”€ models/           # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»ã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ middlewares/      # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”œâ”€â”€ libs/             # å¤–éƒ¨SDKãƒ»API ãƒ©ãƒƒãƒ‘ãƒ¼
â”œâ”€â”€ types/            # å‹å®šç¾©
â”œâ”€â”€ validators/       # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ utils/            # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”œâ”€â”€ constants/        # å®šæ•°å®šç¾©
â”œâ”€â”€ config/           # è¨­å®šç®¡ç†
â”œâ”€â”€ logger.ts         # ãƒ­ã‚°è¨­å®š
â””â”€â”€ index.ts          # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

## ğŸš€ Honoãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### âœ… æ¨å¥¨
```typescript
// âœ… å‹æ¨è«–ã‚’æ´»ç”¨ã—ãŸãƒ«ãƒ¼ãƒˆå®šç¾©
app.get('/users/:id', (c) => {
  const id = c.req.param('id') // å‹æ¨è«–ãŒåŠ¹ã
  return c.json({ id })
})

// âœ… app.route()ã‚’ä½¿ç”¨ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–
import users from './routes/users'
app.route('/api/users', users)

// âœ… factory.createHandlers()ã‚’ä½¿ç”¨ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
import { createFactory } from 'hono/factory'
const factory = createFactory()
const handlers = factory.createHandlers(middleware, handler)
```

### âŒ éæ¨å¥¨
```typescript
// âŒ Railsé¢¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
const userController = (c: Context) => {
  const id = c.req.param('id') // å‹æ¨è«–ãŒåŠ¹ã‹ãªã„
  return c.json({ id })
}
app.get('/users/:id', userController)
```

## ğŸ› ï¸ TypeScriptãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### å‹å®šç¾©
```typescript
// å³æ ¼ãªå‹å®šç¾©ã‚’ä½¿ç”¨
interface User {
  readonly id: string
  name: string
  email: string
  createdAt: Date
}

// DTOã®æ˜ç¢ºãªå®šç¾©
interface CreateUserDTO {
  name: string
  email: string
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ã®å®šç¾©
interface ApiResponse<T> {
  success: boolean
  data?: T
  error?: string
}
```

### ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†
```typescript
// env.ts
import { z } from 'zod'

const envSchema = z.object({
  PORT: z.coerce.number().default(3000),
  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
  DATABASE_URL: z.string(),
})

export const env = envSchema.parse(process.env)
```

## ğŸ§© SOLIDåŸå‰‡ã®é©ç”¨

### Single Responsibility Principle (SRP)
```typescript
// âœ… å˜ä¸€ã®è²¬ä»»ã‚’æŒã¤ã‚¯ãƒ©ã‚¹
class UserService {
  constructor(private userRepo: UserRepository) {}

  async createUser(userData: CreateUserDTO): Promise<User> {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿
  }
}

class UserRepository {
  async save(user: User): Promise<User> {
    // ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®ã¿
  }
}
```

### Open/Closed Principle (OCP)
```typescript
// âœ… æ‹¡å¼µã«é–‹ã‹ã‚Œã€å¤‰æ›´ã«é–‰ã˜ã‚‰ã‚ŒãŸè¨­è¨ˆ
interface NotificationService {
  send(message: string): Promise<void>
}

class EmailService implements NotificationService {
  async send(message: string): Promise<void> {
    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Ÿè£…
  }
}

class SlackService implements NotificationService {
  async send(message: string): Promise<void> {
    // Slacké€ä¿¡å®Ÿè£…
  }
}
```

### Dependency Inversion Principle (DIP)
```typescript
// âœ… æŠ½è±¡ã«ä¾å­˜ã™ã‚‹è¨­è¨ˆ
interface IUserRepository {
  findById(id: string): Promise<User | null>
  save(user: User): Promise<User>
}

class UserService {
  constructor(private userRepo: IUserRepository) {}

  async getUser(id: string): Promise<User | null> {
    return await this.userRepo.findById(id)
  }
}
```

## ğŸ” ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```typescript
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message)
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
app.onError((err, c) => {
  if (err instanceof AppError) {
    return c.json({ error: err.message }, err.statusCode)
  }

  console.error(err)
  return c.json({ error: 'Internal Server Error' }, 500)
})
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
```typescript
// services/user.service.test.ts
describe('UserService', () => {
  let userService: UserService
  let mockUserRepo: jest.Mocked<IUserRepository>

  beforeEach(() => {
    mockUserRepo = {
      findById: jest.fn(),
      save: jest.fn(),
    }
    userService = new UserService(mockUserRepo)
  })

  it('should return user when found', async () => {
    const mockUser = { id: '1', name: 'Test User', email: 'test@example.com' }
    mockUserRepo.findById.mockResolvedValue(mockUser)

    const result = await userService.getUser('1')

    expect(result).toEqual(mockUser)
    expect(mockUserRepo.findById).toHaveBeenCalledWith('1')
  })
})
```

## ğŸ“ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### Zodã‚’ä½¿ç”¨ã—ãŸå‹å®‰å…¨ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```typescript
import { z } from 'zod'
import { zValidator } from '@hono/zod-validator'

const createUserSchema = z.object({
  name: z.string().min(1).max(100),
  email: z.string().email(),
})

app.post('/users', zValidator('json', createUserSchema), async (c) => {
  const userData = c.req.valid('json') // å‹å®‰å…¨
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå‡¦ç†
})
```

## ğŸ”§ é–‹ç™ºãƒ„ãƒ¼ãƒ«è¨­å®š

### ESLint + Prettier
```json
// .eslintrc.js
{
  "extends": [
    "@typescript-eslint/recommended",
    "@typescript-eslint/recommended-requiring-type-checking",
    "prettier"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/prefer-const": "error",
    "@typescript-eslint/no-explicit-any": "error"
  }
}
```

### TypeScriptè¨­å®š
```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "allowSyntheticDefaultImports": true,
    "noUncheckedIndexedAccess": true
  }
}
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### åŠ¹ç‡çš„ãªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ä½¿ç”¨
```typescript
import { cors } from 'hono/cors'
import { logger } from 'hono/logger'
import { compress } from 'hono/compress'

app.use('*', cors())
app.use('*', logger())
app.use('*', compress())
```

### é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä½¿ç”¨
```typescript
app.post('/users', async (c) => {
  const user = await userService.create(userData)
  return c.json(user, 201) // Created
})

app.get('/users/:id', async (c) => {
  const user = await userService.findById(id)
  if (!user) {
    return c.json({ error: 'User not found' }, 404)
  }
  return c.json(user, 200)
})
```

## ğŸ’¡ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãéš›ã®ç¢ºèªäº‹é …
- [ ] å‹å®‰å…¨æ€§ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] SOLIDåŸå‰‡ã«å¾“ã£ã¦ã„ã‚‹ã‹
- [ ] é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ†ã‚¹ãƒˆãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã‚’è€ƒæ…®ã—ã¦ã„ã‚‹ã‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹
- [ ] ãƒ­ã‚°ãŒé©åˆ‡ã«å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã‹

## ğŸ¯ å®Ÿè£…æ™‚ã®é‡è¦ãªè€ƒæ…®äº‹é …
1. **å‹æ¨è«–ã‚’æ´»ç”¨**: TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æœ€å¤§é™æ´»ç”¨
2. **ä¾å­˜é–¢ä¿‚ã®æ˜ç¢ºåŒ–**: DIã‚³ãƒ³ãƒ†ãƒŠã‚„ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨
3. **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ¢ãƒƒã‚¯ã—ã‚„ã™ã„è¨­è¨ˆ
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä¸è¦ãªå‡¦ç†ã®å‰Šé™¤ã¨æœ€é©åŒ–
5. **ä¿å®ˆæ€§**: å°†æ¥ã®å¤‰æ›´ã«å¯¾ã™ã‚‹æŸ”è»Ÿæ€§

ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã£ã¦ã€ä¿å®ˆæ€§ãŒé«˜ãã€æ‹¡å¼µå¯èƒ½ã§ã€å‹å®‰å…¨ãªHonoã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„ã€‚